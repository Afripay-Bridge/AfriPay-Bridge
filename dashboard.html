<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AfriPay Bridge Dashboard</title>
<style>
  body { margin:0; font-family:'Segoe UI',sans-serif; background:#F4F6F8; color:#1A1A1A; }
  header { background:#1ABC9C; color:white; padding:20px; text-align:center; }
  header h1 { margin:0; font-size:2em; }
  nav { display:flex; justify-content:center; gap:15px; margin-top:10px; }
  nav button { padding:8px 15px; border:none; border-radius:8px; background:white; color:#1ABC9C; cursor:pointer; transition:0.2s; }
  nav button:hover { background:#16A085; color:white; }

  .container { max-width:1200px; margin:20px auto; padding:0 20px; }
  .wallet-card { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05); text-align:center; display:inline-block; width:180px; margin:10px; vertical-align:top; }
  .wallet-card h3 { margin:10px 0; color:#16A085; }
  .wallet-card p { font-weight:bold; font-size:1.2em; margin:5px 0; }

  .section { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05); margin-bottom:20px; }
  h2 { color:#1ABC9C; margin-bottom:15px; }

  input, select { padding:10px; margin:5px 0; border-radius:8px; border:1px solid #ccc; width:100%; display:inline-block; }
  button.form-btn { padding:12px 20px; border:none; border-radius:8px; background:#F1C40F; color:#1A1A1A; font-weight:bold; cursor:pointer; margin-top:10px; width:100%; transition:0.2s; }
  button.form-btn:hover { background:#D4AC0D; }

  .transactions table { width:100%; border-collapse:collapse; margin-top:10px; }
  .transactions th, .transactions td { padding:10px; border-bottom:1px solid #eee; text-align:center; }
  .transactions th { background:#16A085; color:white; }

  .flex-row { display:flex; flex-wrap:wrap; gap:20px; }
  .inline-block { display:inline-block; vertical-align:top; }

  .logout-btn { background:#E74C3C; color:white; width:auto; margin-top:0; }
  .logout-btn:hover { background:#C0392B; }
</style>
</head>
<body>

<header>
  <h1>AfriPay Bridge Dashboard</h1>
  <nav>
    <button onclick="scrollToSection('wallets')">Wallets</button>
    <button onclick="scrollToSection('send')">Send Money</button>
    <button onclick="scrollToSection('crypto')">Crypto Deposit/Withdraw</button>
    <button onclick="scrollToSection('transactions')">Transactions</button>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </nav>
</header>

<div class="container">

  <!-- Wallets Section -->
  <section id="wallets" class="section">
    <h2>My Wallets</h2>
    <div id="walletCards" class="flex-row">
      <!-- Wallet cards generated by JS -->
    </div>
  </section>

  <!-- Send Money Section -->
  <section id="send" class="section">
    <h2>Send Money</h2>
    <input type="text" id="recipientUid" placeholder="Recipient User ID">
    <input type="number" id="sendAmount" placeholder="Amount">
    <select id="sendCurrency">
      <option value="USD">USD</option>
      <option value="ZMW">ZMW</option>
      <option value="NGN">NGN</option>
      <option value="BTC">BTC</option>
      <option value="USDT">USDT</option>
    </select>
    <button class="form-btn" id="sendBtn">Send</button>
  </section>

  <!-- Crypto Deposit/Withdraw Section -->
  <section id="crypto" class="section">
    <h2>Crypto Deposit / Withdraw</h2>
    <input type="text" id="cryptoType" placeholder="Crypto Type (BTC/USDT)">
    <input type="number" id="cryptoAmount" placeholder="Amount">
    <select id="cryptoAction">
      <option value="deposit">Deposit</option>
      <option value="withdraw">Withdraw</option>
    </select>
    <button class="form-btn" id="cryptoBtn">Execute</button>
  </section>

  <!-- Transactions Section -->
  <section id="transactions" class="section transactions">
    <h2>Transaction History</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Type</th>
          <th>From</th>
          <th>To</th>
          <th>Amount</th>
          <th>Currency</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="transactionsBody">
        <!-- Transactions loaded via JS -->
      </tbody>
    </table>
  </section>

</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Redirect if not logged in
onAuthStateChanged(auth, async (user) => {
  if(!user) location.href="index.html";
  else loadWallets(user.uid);
});

// Logout
document.getElementById("logoutBtn").addEventListener("click", async ()=> {
  await signOut(auth);
  location.href="index.html";
});

// Scroll helper
function scrollToSection(id){
  document.getElementById(id).scrollIntoView({behavior:'smooth'});
}

// Load wallet cards
async function loadWallets(uid){
  const walletCards = document.getElementById("walletCards");
  walletCards.innerHTML = '';
  const walletsSnap = await getDocs(query(collection(db,"wallets"), where("userId","==",uid)));
  walletsSnap.forEach(docSnap=>{
    const data = docSnap.data();
    const card = document.createElement("div");
    card.className="wallet-card inline-block";
    card.innerHTML=`<h3>${data.currency} Wallet</h3><p>${data.balance.toFixed(2)}</p>`;
    walletCards.appendChild(card);
  });
}

// Send money, crypto, transactions handling will be added next (via cloud functions or Firestore)
</script>

</body>
</html>
